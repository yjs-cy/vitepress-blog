# ç±»å‹ç¼©å°

## ğŸ” ç†è§£ç±»å‹ç¼©å°

å½“ä½ åœ¨TypeScriptä¸­ä½¿ç”¨è”åˆç±»å‹æ—¶ï¼Œç±»å‹ç¼©å°æ˜¯æŒ‡TypeScriptæ ¹æ®ä»£ç é€»è¾‘ï¼Œ**å°†å˜é‡çš„ç±»å‹ä»æ›´å®½æ³›çš„ç±»å‹æ¨å¯¼ä¸ºæ›´å…·ä½“ç±»å‹çš„è¿‡ç¨‹**ã€‚

æ¯”å¦‚ä¸€ä¸ªç±»å‹ä¸º `string | number` çš„å˜é‡ï¼Œç»è¿‡ç±»å‹ç¼©å°åï¼Œåœ¨ç‰¹å®šä»£ç å—ä¸­TypeScriptå¯ä»¥ç¡®å®šå®ƒå…·ä½“æ˜¯`string`è¿˜æ˜¯`number`ï¼š

```typescript
function printId(id: number | string) {
  // è¿™é‡Œç›´æ¥ä½¿ç”¨ä¼šæŠ¥é”™ï¼Œå› ä¸ºidå¯èƒ½æ˜¯numberæˆ–string
  // console.log(id.toUpperCase()); // é”™è¯¯ï¼
  
  if (typeof id === "string") {
    // åœ¨è¿™é‡Œï¼ŒTypeScriptçŸ¥é“idä¸€å®šæ˜¯string
    console.log(id.toUpperCase()); // æ­£ç¡®
  } else {
    // åœ¨è¿™é‡Œï¼ŒTypeScriptçŸ¥é“idä¸€å®šæ˜¯number
    console.log(id);
  }
}

```

## ğŸ› ï¸ å¸¸ç”¨çš„ç±»å‹ç¼©å°æ–¹æ³•

### 1. `typeof` ç±»å‹ä¿æŠ¤

æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œé€‚ç”¨äºåŸºæœ¬ç±»å‹åˆ¤æ–­ï¼š"string"ã€"number"ã€"bigint"ã€"boolean"ã€"symbol"ã€"undefined"ã€"object"ã€"function"

```typescript
function processValue(value: string | number) {
  if (typeof value === "string") {
    return value.length; // valueæ˜¯string
  }
  return value.toFixed(2); // valueæ˜¯number
}
```
ä½†æ˜¯è¿™ä¸ªtypeofæ— æ³•å‡†ç¡®æ ¡éªŒå‡º`null`å’Œ`object`çš„åŒºåˆ«

### 2. çœŸå€¼ç¼©å°

`if`è¿™æ ·çš„æ„é€ é¦–å…ˆå°†å®ƒä»¬çš„æ¡ä»¶ â€œå¼ºåˆ¶è½¬æ¢â€ åˆ°`boolean`æ¥ç†è§£å®ƒä»¬ï¼Œç„¶åæ ¹æ®ç»“æœæ˜¯`true`è¿˜æ˜¯`false`æ¥é€‰æ‹©å®ƒä»¬çš„åˆ†æ”¯ã€‚

åƒ0ã€NaNã€â€œâ€(ç©ºå­—ç¬¦)ã€0n(bigint ç‰ˆæœ¬é›¶)ã€nullã€undefinedéƒ½ä¼šå¼ºåˆ¶è½¬æ¢ä¸º`false`ï¼Œå…¶ä»–å€¼å¼ºåˆ¶è½¬æ¢ä¸º`true`ã€‚

é€šè¿‡åˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨æ¥è¿›è¡Œç±»å‹ç¼©å°ï¼š

```typescript
function printAll(strs: string | string[] | null) {
  if (strs && typeof strs === "object") {
    // strsæ˜¯æ•°ç»„ï¼ˆä¸æ˜¯nullä¹Ÿä¸æ˜¯å•ä¸ªstringï¼‰
    for (const s of strs) {
      console.log(s);
    }
  } else if (typeof strs === "string") {
    console.log(strs);
  }
}
```
### 3. ç›¸ç­‰æ€§ç¼©å°

TypeScript è¿˜ä½¿ç”¨`switch`è¯­å¥å’Œ`===`ã€`!==`ã€`==`å’Œ`!=`ç­‰ç›¸ç­‰æ€§æ£€æŸ¥æ¥ç¼©å°ç±»å‹ã€‚

JavaScript å¯¹`==`å’Œ`!=`çš„æ›´å®½æ¾çš„ç›¸ç­‰æ€§æ£€æŸ¥ä¹Ÿæ­£ç¡®åœ°ç¼©å°äº†ç±»å‹ã€‚

`== null`å’Œ`== undefined`ä¸¤ç§å†™æ³•éƒ½åšåˆ°äº†æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯`null`è¿˜æ˜¯`undefined`ã€‚

### 4. `in` æ“ä½œç¬¦

æ£€æŸ¥å¯¹è±¡æ˜¯å¦å…·æœ‰ç‰¹å®šå±æ€§ï¼š

```typescript
type Fish = { swim: () => void };
type Bird = { fly: () => void };

function move(animal: Fish | Bird) {
  if ("swim" in animal) {
    return animal.swim(); // animalæ˜¯Fish
  }
  return animal.fly(); // animalæ˜¯Bird
}
```
### 5. `instanceof` æ£€æŸ¥

ç”¨äºæ£€æŸ¥å¯¹è±¡æ˜¯å¦å±äºæŸä¸ªç±»çš„å®ä¾‹ï¼š

```typescript
function logValue(x: Date | string) {
  if (x instanceof Date) {
    console.log(x.toUTCString()); // xæ˜¯Date
  } else {
    console.log(x.toUpperCase()); // xæ˜¯string
  }
}
```

### 5. ç±»å‹è°“è¯

åˆ›å»ºè¿”å›ç±»å‹è°“è¯çš„å‡½æ•°

```typescript
function isFish(pet: Fish | Bird): pet is Fish {
  return (pet as Fish).swim !== undefined;
}

function getPet(pet: Fish | Bird) {
  if (isFish(pet)) {
    return pet.swim(); // petæ˜¯Fish
  }
  return pet.fly(); // petæ˜¯Bird
}

```

### 6. åˆ¤åˆ«è”åˆ

åˆ¤åˆ«è”åˆï¼ˆDiscriminated Unionsï¼‰æ˜¯é€šè¿‡ä¸€ä¸ªâ€œå…±åŒå±æ€§â€æ¥æ˜ç¡®åŒºåˆ†ä¸åŒç±»å‹çš„æ•°æ®ç»“æ„ï¼Œè®©ç±»å‹æ£€æŸ¥å™¨èƒ½è‡ªåŠ¨è¯†åˆ«å½“å‰æ•°æ®å±äºå“ªç§å…·ä½“ç±»å‹ï¼Œä»è€Œé¿å…é”™è¯¯è®¿é—®ä¸å­˜åœ¨çš„å±æ€§ã€‚

```typescript
interface Apple {
  type: "apple"; // åˆ¤åˆ«å±æ€§ï¼Œå”¯ä¸€æ ‡è®°
  weight: number; // è‹¹æœç‰¹æœ‰çš„å±æ€§
}

interface Banana {
  type: "banana"; // åˆ¤åˆ«å±æ€§ï¼Œå”¯ä¸€æ ‡è®°
  length: number; // é¦™è•‰ç‰¹æœ‰çš„å±æ€§
}

type Fruit = Apple | Banana; // è”åˆç±»å‹ï¼šè‹¹æœæˆ–é¦™è•‰

function getSize(fruit: Fruit) {
  if (fruit.type === "apple") {
    // æ­¤æ—¶ç±»å‹æ£€æŸ¥å™¨çŸ¥é“ fruit ä¸€å®šæ˜¯ Apple ç±»å‹
    return fruit.weight; // å®‰å…¨è®¿é—® weight
  } else if (fruit.type === "banana") {
    // æ­¤æ—¶ç±»å‹æ£€æŸ¥å™¨çŸ¥é“ fruit ä¸€å®šæ˜¯ Banana ç±»å‹
    return fruit.length; // å®‰å…¨è®¿é—® length
  }
}
```

### 7. å½»åº•æ€§æ£€æŸ¥

ä½¿ç”¨`never`ç±»å‹ç¡®ä¿å¤„ç†äº†æ‰€æœ‰å¯èƒ½çš„æƒ…å†µï¼š

```typescript
type Shape = 
  | { kind: "circle"; radius: number }
  | { kind: "square"; side: number }
  | { kind: "triangle"; base: number; height: number };

function getArea(shape: Shape): number {
  switch (shape.kind) {
    case "circle":
      return Math.PI * shape.radius ** 2;
    case "square":
      return shape.side ** 2;
    case "triangle":
      return 0.5 * shape.base * shape.height;
    default:
      // ç¡®ä¿å¤„ç†äº†æ‰€æœ‰æƒ…å†µ
      const _exhaustiveCheck: never = shape;
      return _exhaustiveCheck;
  }
}

```